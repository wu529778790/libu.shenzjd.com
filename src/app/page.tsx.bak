import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAppStore } from '@/store/appStore';
import { CryptoService } from '@/lib/crypto';
import { BackupService, ExcelImportResult } from '@/lib/backup';
import { Utils } from '@/lib/utils';
import PageLayout from '@/components/layout/PageLayout';
import FormLayout from '@/components/layout/FormLayout';
import Button from '@/components/ui/Button';
import Input from '@/components/ui/Input';
import EventSelector from '@/components/business/EventSelector';
import { formatDate, formatDateTime } from '@/utils/format';
import ImportExcelModal from '@/components/business/ImportExcelModal';

export default function Home() {
  const navigate = useNavigate();
  const { state, actions } = useAppStore();
  const [showPasswordInput, setShowPasswordInput] = useState(false);
  const [showSessionChoice, setShowSessionChoice] = useState(false);
  const [selectedEvent, setSelectedEvent] = useState<any>(null);
  const [currentSessionEvent, setCurrentSessionEvent] = useState<any>(null);
  const [password, setPassword] = useState('');
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');
  const [showImportModal, setShowImportModal] = useState(false);
  const [importSuccessMsg, setImportSuccessMsg] = useState<string | null>(null);

  // åˆå§‹åŒ–æ—¶æ£€æŸ¥ä¼šè¯çŠ¶æ€
  useEffect(() => {
    // ç­‰å¾…äº‹ä»¶åŠ è½½å®Œæˆ
    if (state.loading.events) {
      return; // å¦‚æœäº‹ä»¶è¿˜åœ¨åŠ è½½ï¼Œä¸æ‰§è¡Œåç»­é€»è¾‘
    }

    // æ£€æŸ¥å½“å‰ä¼šè¯
    const session = sessionStorage.getItem('currentEvent');
    if (session) {
      try {
        const { event: currentEvent } = JSON.parse(session);
        setShowSessionChoice(true);
        setCurrentSessionEvent(currentEvent);
        return;
      } catch (e) {
        console.error('Failed to parse session:', e);
      }
    }

    // æ²¡æœ‰ä¼šè¯ä½†æœ‰äº‹ä»¶ â†’ æ˜¾ç¤ºäº‹ä»¶ç®¡ç†ç•Œé¢ï¼Œå¹¶é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªäº‹ä»¶
    if (state.events.length > 0) {
      setShowPasswordInput(true);
      setSelectedEvent(state.events[0]); // é»˜è®¤é€‰ä¸­ç¬¬ä¸€ä¸ªäº‹ä»¶
    } else {
      // æ²¡æœ‰äº‹ä»¶ â†’ æ˜¾ç¤ºå¯†ç è¾“å…¥ç•Œé¢ï¼ˆåŒ…å«å¯¼å…¥æŒ‰é’®ï¼‰
      setShowPasswordInput(true);
    }
  }, [state.events, state.loading.events, navigate]);

  const handlePasswordSubmit = async (e: React.FormEvent) => {
    e.preventDefault();
    if (!selectedEvent || !password) return;

    setLoading(true);
    setError('');

    try {
      // éªŒè¯å¯†ç 
      // ç‰¹æ®Šæƒ…å†µï¼šå¦‚æœäº‹ä»¶å¯†ç ä¸ºç©ºï¼ˆå¦‚å¯¼å…¥çš„äº‹ä»¶ï¼‰ï¼Œå…è®¸ä»»ä½•å¯†ç 
      if (selectedEvent.passwordHash === '') {
        // å¯¼å…¥çš„äº‹ä»¶ï¼Œéœ€è¦è®¾ç½®å¯†ç 
        if (confirm('è¿™æ˜¯ä¸€ä¸ªæ–°å¯¼å…¥çš„äº‹ä»¶ï¼Œéœ€è¦è®¾ç½®å¯†ç æ‰èƒ½åŠ å¯†å­˜å‚¨ã€‚\n\næ˜¯å¦ç«‹å³è®¾ç½®å¯†ç ï¼Ÿ\n\nç‚¹å‡»"ç¡®å®š"è®¾ç½®å¯†ç ï¼Œç‚¹å‡»"å–æ¶ˆ"ä½¿ç”¨ä¸´æ—¶å¯†ç è¿›å…¥ï¼ˆä¸å®‰å…¨ï¼‰')) {
          // è®¾ç½®å¯†ç 
          const newHash = CryptoService.hash(password);
          selectedEvent.passwordHash = newHash;

          // æ›´æ–°å­˜å‚¨çš„äº‹ä»¶
          const events = JSON.parse(localStorage.getItem('giftlist_events') || '[]');
          const index = events.findIndex((e: any) => e.id === selectedEvent.id);
          if (index >= 0) {
            events[index] = selectedEvent;
            localStorage.setItem('giftlist_events', JSON.stringify(events));
          }

          // é‡æ–°åŠ å¯†ç¤¼é‡‘æ•°æ®
          const gifts = JSON.parse(localStorage.getItem(`giftlist_gifts_${selectedEvent.id}`) || '[]');
          const encryptedGifts = gifts.map((gift: any) => {
            // æ£€æŸ¥æ˜¯å¦å·²ç»æ˜¯æ­£ç¡®çš„åŠ å¯†æ ¼å¼ï¼ˆæœ‰encryptedDataä¸”æ˜¯åŠ å¯†å­—ç¬¦ä¸²ï¼‰
            // å¯¼å…¥çš„æ•°æ®æ ¼å¼ï¼šencryptedData = '{"name":"å¼ ä¸‰","amount":2000,...}' (æ˜æ–‡JSON)
            // æ­£ç¡®æ ¼å¼ï¼šencryptedData = 'åŠ å¯†åçš„å­—ç¬¦ä¸²'

            // å¦‚æœæœ‰encryptedDataï¼Œå°è¯•åˆ¤æ–­æ˜¯å¦æ˜¯æ˜æ–‡JSON
            if (gift.encryptedData) {
              try {
                // å°è¯•è§£æï¼Œå¦‚æœèƒ½è§£æè¯´æ˜æ˜¯æ˜æ–‡JSONï¼ˆéœ€è¦é‡æ–°åŠ å¯†ï¼‰
                const parsed = JSON.parse(gift.encryptedData);
                // å¦‚æœè§£ææˆåŠŸä¸”æœ‰nameå­—æ®µï¼Œè¯´æ˜æ˜¯å¯¼å…¥çš„æ˜æ–‡æ•°æ®
                if (parsed.name !== undefined) {
                  return {
                    id: gift.id || Utils.generateId(),
                    eventId: selectedEvent.id,
                    encryptedData: CryptoService.encrypt(JSON.stringify(parsed), password)
                  };
                }
              } catch (e) {
                // è§£æå¤±è´¥ï¼Œè¯´æ˜å·²ç»æ˜¯åŠ å¯†æ ¼å¼ï¼Œè·³è¿‡
                return gift;
              }
            }

            // å¦‚æœæ²¡æœ‰encryptedDataï¼Œè¯´æ˜æ˜¯å…¨æ–°æ•°æ®ï¼ˆä¸åº”è¯¥å‘ç”Ÿï¼Œä½†ä¿é™©èµ·è§ï¼‰
            return {
              id: gift.id || Utils.generateId(),
              eventId: selectedEvent.id,
              encryptedData: CryptoService.encrypt(JSON.stringify(gift), password)
            };
          });
          localStorage.setItem(`giftlist_gifts_${selectedEvent.id}`, JSON.stringify(encryptedGifts));

          alert('å¯†ç è®¾ç½®æˆåŠŸï¼æ•°æ®å·²åŠ å¯†å­˜å‚¨ã€‚');
        } else {
          // ç”¨æˆ·é€‰æ‹©ä¸è®¾ç½®å¯†ç ï¼Œä»ç„¶å…è®¸è¿›å…¥ä½†ç»™å‡ºè­¦å‘Š
          if (!confirm('âš ï¸ è­¦å‘Šï¼šæœªè®¾ç½®å¯†ç ï¼Œæ•°æ®å°†ä»¥æ˜æ–‡å­˜å‚¨ï¼Œä¸å®‰å…¨ï¼\n\nç¡®å®šè¦ç»§ç»­å—ï¼Ÿ')) {
            setLoading(false);
            return;
          }
        }
      } else {
        // æ­£å¸¸å¯†ç éªŒè¯
        const hash = CryptoService.hash(password);
        if (hash !== selectedEvent.passwordHash) {
          setError('å¯†ç é”™è¯¯ï¼');
          setLoading(false);
          return;
        }
      }

      // ä¿å­˜ä¼šè¯
      actions.saveSession(selectedEvent, password);

      // è¿›å…¥ä¸»ç•Œé¢
      navigate('/main', { replace: true });
    } catch (err) {
      console.error(err);
      setError('ç™»å½•å¤±è´¥: ' + err);
    } finally {
      setLoading(false);
    }
  };

  // å¤„ç†ç»§ç»­ä½¿ç”¨å½“å‰ä¼šè¯
  const handleContinueSession = () => {
    navigate('/main');
  };

  // å¤„ç†åˆ‡æ¢åˆ°å…¶ä»–äº‹ä»¶
  const handleSwitchFromSession = () => {
    actions.clearSession();
    setShowSessionChoice(false);
    if (state.events.length > 0) {
      setSelectedEvent(state.events[0]);
      setShowPasswordInput(true);
    }
  };

  // å¤„ç†åˆ‡æ¢åˆ°ç‰¹å®šäº‹ä»¶
  const handleSwitchToSpecificEvent = (targetEvent: any) => {
    setSelectedEvent(targetEvent);
    setShowPasswordInput(true);
    setShowSessionChoice(false);
  };

  // å¤„ç†åˆ›å»ºæ–°äº‹ä»¶
  const handleCreateNewEvent = () => {
    navigate('/setup');
  };

  // å¤„ç†å¯¼å…¥ExcelæˆåŠŸ
  const handleImportSuccess = (result: ExcelImportResult) => {
    // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
    let msg = `æˆåŠŸå¯¼å…¥ ${result.gifts} æ¡ç¤¼é‡‘è®°å½•`;
    if (result.events > 0) {
      msg += `ã€${result.events} ä¸ªäº‹ä»¶`;
    }
    if (result.conflicts > 0) {
      msg += `ï¼Œè·³è¿‡ ${result.skipped} æ¡é‡å¤`;
    }
    setImportSuccessMsg(result.message || msg);

    // å…³é—­æ¨¡æ€æ¡†
    setShowImportModal(false);

    // é‡æ–°åŠ è½½äº‹ä»¶åˆ—è¡¨
    actions.loadEvents();

    // å¦‚æœæœ‰å¯¼å…¥äº‹ä»¶ï¼Œ3ç§’åæ˜¾ç¤ºå¯†ç è¾“å…¥ç•Œé¢
    if (result.events > 0) {
      setTimeout(() => {
        setShowPasswordInput(true);
      }, 3000);
    }
  };

  // ç›‘å¬äº‹ä»¶åˆ—è¡¨å˜åŒ–ï¼Œè‡ªåŠ¨æ˜¾ç¤ºå¯†ç è¾“å…¥ç•Œé¢
  useEffect(() => {
    if (importSuccessMsg && state.events.length > 0) {
      // äº‹ä»¶åˆ—è¡¨å·²åŠ è½½ï¼Œè‡ªåŠ¨è·³è½¬åˆ°å¯†ç è¾“å…¥ç•Œé¢
      setTimeout(() => {
        setImportSuccessMsg(null);
        setShowPasswordInput(true);
      }, 1000);
    }
  }, [state.events, importSuccessMsg]);

  // ä¼šè¯é€‰æ‹©ç•Œé¢
  if (showSessionChoice) {
    return (
      <>
        <PageLayout title="ç”µå­ç¤¼ç°¿ç³»ç»Ÿ" subtitle="æ£€æµ‹åˆ°å½“å‰ä¼šè¯">
          <FormLayout>
            <div className="mb-4 p-3 bg-blue-50 border border-blue-200 rounded">
              <div className="font-bold text-blue-900 mb-1 text-sm">
                å½“å‰äº‹ä»¶ï¼š
              </div>
              <div className="text-sm text-blue-800 font-semibold">
                {currentSessionEvent?.name}
              </div>
              <div className="text-xs text-blue-600 mt-1">
                {currentSessionEvent &&
                  `${formatDate(
                    currentSessionEvent.startDateTime
                  )} ~ ${formatDate(currentSessionEvent.endDateTime)}`}
              </div>
            </div>

            <div className="space-y-3">
              <Button
                variant="primary"
                className="w-full p-3 rounded-lg font-bold"
                onClick={handleContinueSession}
              >
                ç»§ç»­ä½¿ç”¨å½“å‰äº‹ä»¶
              </Button>

              <Button
                variant="secondary"
                className="w-full p-3 rounded-lg font-bold"
                onClick={handleSwitchFromSession}
              >
                åˆ‡æ¢åˆ°å…¶ä»–äº‹ä»¶ï¼ˆéœ€é‡æ–°è¾“å…¥å¯†ç ï¼‰
              </Button>

              {state.events.length > 1 && (
                <div className="pt-3 border-t themed-border">
                  <p className="text-sm text-gray-600 mb-2">
                    å¿«é€Ÿåˆ‡æ¢ï¼ˆéœ€é‡æ–°è¾“å…¥å¯†ç ï¼‰ï¼š
                  </p>
                  <div className="space-y-2">
                    {state.events.map(
                      (ev: any) =>
                        ev.id !== currentSessionEvent?.id && (
                          <Button
                            key={ev.id}
                            variant="secondary"
                            className="w-full text-left px-3 py-2 text-sm !bg-gray-100 !text-gray-800 !border-transparent hover:!bg-gray-200"
                            onClick={() => handleSwitchToSpecificEvent(ev)}
                          >
                            {ev.name}
                          </Button>
                        )
                    )}
                  </div>
                </div>
              )}

              <div className="pt-3 border-t themed-border space-y-2">
                <div className="flex gap-2">
                  <Button
                    variant="secondary"
                    className="flex-1 text-sm p-2 rounded"
                    onClick={handleCreateNewEvent}
                  >
                    âœ¨ åˆ›å»ºæ–°äº‹ä»¶
                  </Button>
                  <Button
                    variant="secondary"
                    className="flex-1 text-sm p-2 rounded"
                    onClick={() => setShowImportModal(true)}
                  >
                    ğŸ“¥ å¯¼å…¥æ•°æ®
                  </Button>
                </div>
                <Button
                  variant="danger"
                  className="w-full p-2 rounded text-sm"
                  onClick={() => {
                    actions.clearSession();
                    navigate('/', { replace: true });
                  }}
                >
                  ğŸ”„ è¿”å›é¦–é¡µé‡æ–°é€‰æ‹©
                </Button>
              </div>
            </div>
          </FormLayout>
        </PageLayout>

        {/* å¯¼å…¥Excelæ¨¡æ€æ¡† */}
        <ImportExcelModal
          isOpen={showImportModal}
          onClose={() => setShowImportModal(false)}
          onImportSuccess={handleImportSuccess}
          currentEvent={selectedEvent}
          allEvents={state.events}
        />
      </>
    );
  }

  // å¯†ç è¾“å…¥ç•Œé¢
  if (showPasswordInput) {
    // æ²¡æœ‰äº‹ä»¶ï¼Œæ˜¾ç¤ºç©ºçŠ¶æ€ç•Œé¢
    if (state.events.length === 0) {
      return (
        <>
          <PageLayout
            title="ç”µå­ç¤¼ç°¿ç³»ç»Ÿ"
            subtitle="è¿˜æ²¡æœ‰äº‹ä»¶ï¼Œè¯·é€‰æ‹©æ“ä½œ"
          >
            <FormLayout>
              {/* å¯¼å…¥æˆåŠŸæç¤º */}
              {importSuccessMsg && (
                <div className="mb-4 bg-green-50 border border-green-200 rounded-lg p-3 flex items-center justify-between animate-fade-in">
                  <div className="flex items-center gap-2 text-green-800 text-sm">
                    <span>âœ…</span>
                    <span>{importSuccessMsg}</span>
                  </div>
                  <button
                    onClick={() => setImportSuccessMsg(null)}
                    className="text-green-600 hover:text-green-800 font-bold"
                  >
                    Ã—
                  </button>
                </div>
              )}

              <div className="space-y-3">
                <div className="text-center text-gray-600 mb-4">
                  <p className="text-sm">æ¬¢è¿ä½¿ç”¨ç”µå­ç¤¼ç°¿ç³»ç»Ÿ</p>
                  <p className="text-xs mt-1">æ‚¨å¯ä»¥åˆ›å»ºæ–°äº‹ä»¶æˆ–å¯¼å…¥Excelæ•°æ®</p>
                </div>

                <Button
                  variant="primary"
                  className="w-full p-3 rounded-lg font-bold"
                  onClick={handleCreateNewEvent}
                >
                  âœ¨ åˆ›å»ºæ–°äº‹ä»¶
                </Button>

                <Button
                  variant="secondary"
                  className="w-full p-3 rounded-lg font-bold"
                  onClick={() => setShowImportModal(true)}
                >
                  ğŸ“¥ å¯¼å…¥æ•°æ®
                </Button>

                <div className="pt-4 border-t themed-border">
                  <p className="text-xs text-gray-500 text-center">
                    ğŸ’¡ æç¤ºï¼šæ”¯æŒå¯¼å…¥Excelæ–‡ä»¶åˆ›å»ºæ–°äº‹ä»¶æˆ–åˆå¹¶æ•°æ®
                  </p>
                </div>
              </div>
            </FormLayout>
          </PageLayout>

          {/* å¯¼å…¥Excelæ¨¡æ€æ¡† */}
          <ImportExcelModal
            isOpen={showImportModal}
            onClose={() => setShowImportModal(false)}
            onImportSuccess={handleImportSuccess}
            currentEvent={selectedEvent}
            allEvents={state.events}
          />
        </>
      );
    }

    // æœ‰äº‹ä»¶ä½†æ²¡æœ‰é€‰ä¸­ï¼Œæ˜¾ç¤ºäº‹ä»¶é€‰æ‹©å™¨
    if (!selectedEvent && state.events.length > 0) {
      return (
        <>
          <PageLayout
            title="ç”µå­ç¤¼ç°¿ç³»ç»Ÿ"
            subtitle="è¯·é€‰æ‹©äº‹ä»¶å¹¶è¾“å…¥å¯†ç "
          >
            <FormLayout>
              {/* å¤‡ä»½æé†’ */}
              {BackupService.hasData() && (
                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4">
                  <div className="flex items-start gap-2">
                    <span className="text-yellow-600">âš ï¸</span>
                    <div>
                      <p className="font-semibold text-yellow-800 text-sm">é‡è¦æé†’</p>
                      <p className="text-xs text-yellow-700 mt-1">
                        æ‰€æœ‰æ•°æ®å­˜å‚¨åœ¨æµè§ˆå™¨ä¸­ã€‚è¯·å®šæœŸå¯¼å‡ºå¤‡ä»½ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±ï¼
                      </p>
                      <div className="mt-2 flex gap-2">
                        <Button
                          size="sm"
                          onClick={() => navigate('/main')}
                        >
                          ç«‹å³å¤‡ä»½
                        </Button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              <EventSelector
                events={state.events}
                onSelect={(event) => {
                  setSelectedEvent(event);
                  setError('');
                }}
                onCreateNew={handleCreateNewEvent}
                title="é€‰æ‹©æ´»åŠ¨"
                subtitle="è¯·é€‰æ‹©è¦ç®¡ç†çš„æ´»åŠ¨"
              />

              <div className="pt-4 border-t themed-border space-y-2">
                <div className="flex gap-2">
                  <Button
                    variant="secondary"
                    className="flex-1 text-sm p-2 rounded"
                    onClick={handleCreateNewEvent}
                  >
                    âœ¨ åˆ›å»ºæ–°äº‹ä»¶
                  </Button>
                  <Button
                    variant="secondary"
                    className="flex-1 text-sm p-2 rounded"
                    onClick={() => setShowImportModal(true)}
                  >
                    ğŸ“¥ å¯¼å…¥æ•°æ®
                  </Button>
                </div>
                <Button
                  variant="danger"
                  className="w-full text-sm p-2 rounded"
                  onClick={() => {
                    if (
                      confirm(
                        "ç¡®å®šè¦åˆ é™¤æ‰€æœ‰äº‹ä»¶å—ï¼Ÿç¤¼é‡‘è®°å½•ä¼šä¿ç•™ä½†æ— æ³•è®¿é—®ã€‚"
                      )
                    ) {
                      localStorage.removeItem('giftlist_events');
                      window.location.reload();
                    }
                  }}
                >
                  ğŸ—‘ï¸ æ¸…é™¤äº‹ä»¶
                </Button>
              </div>
            </FormLayout>
          </PageLayout>

          {/* å¯¼å…¥Excelæ¨¡æ€æ¡† */}
          <ImportExcelModal
            isOpen={showImportModal}
            onClose={() => setShowImportModal(false)}
            onImportSuccess={handleImportSuccess}
            currentEvent={selectedEvent}
            allEvents={state.events}
          />
        </>
      );
    }

    // æœ‰é€‰ä¸­äº‹ä»¶ï¼Œæ˜¾ç¤ºå¯†ç è¾“å…¥
    return (
      <>
        <PageLayout
          title="ç”µå­ç¤¼ç°¿ç³»ç»Ÿ"
          subtitle="è¯·è¾“å…¥å¯†ç ç»§ç»­"
        >
          <FormLayout>
            {/* é€‰ä¸­äº‹ä»¶åçš„ä¿¡æ¯ */}
            <div className="mb-4 p-3 themed-ring rounded-lg text-sm">
              <div className="font-bold text-gray-700">
                {selectedEvent.name}
              </div>
              <div className="text-gray-600 mt-1">
                {`${formatDateTime(
                  selectedEvent.startDateTime
                )} ~ ${formatDateTime(selectedEvent.endDateTime)}`}
              </div>
              <Button
                variant="secondary"
                className="mt-2 text-xs !p-1 !h-auto"
                onClick={() => {
                  setSelectedEvent(null);
                  setError('');
                }}
              >
                â† é‡æ–°é€‰æ‹©äº‹ä»¶
              </Button>
            </div>

            <form onSubmit={handlePasswordSubmit} className="space-y-4">
              <div>
                <Input
                  label="ç®¡ç†å¯†ç "
                  type="password"
                  value={password}
                  onChange={(e) => {
                    setPassword(e.target.value);
                    setError('');
                  }}
                  placeholder="é»˜è®¤å¯èƒ½æ˜¯ 123456"
                  error={error}
                  autoFocus
                />
              </div>

              <Button
                type="submit"
                variant="primary"
                className="w-full p-3 rounded-lg font-bold"
                disabled={loading}
              >
                {loading ? "ç™»å½•ä¸­..." : "ç™»å½•"}
              </Button>

              <div className="pt-4 border-t themed-border space-y-2">
                <div className="flex gap-2">
                  <Button
                    variant="secondary"
                    className="flex-1 text-sm p-2 rounded"
                    onClick={handleCreateNewEvent}
                  >
                    âœ¨ åˆ›å»ºæ–°äº‹ä»¶
                  </Button>
                  <Button
                    variant="secondary"
                    className="flex-1 text-sm p-2 rounded"
                    onClick={() => setShowImportModal(true)}
                  >
                    ğŸ“¥ å¯¼å…¥æ•°æ®
                  </Button>
                </div>
                <Button
                  variant="danger"
                  className="w-full text-sm p-2 rounded"
                  onClick={() => {
                    if (
                      confirm(
                        "ç¡®å®šè¦åˆ é™¤æ‰€æœ‰äº‹ä»¶å—ï¼Ÿç¤¼é‡‘è®°å½•ä¼šä¿ç•™ä½†æ— æ³•è®¿é—®ã€‚"
                      )
                    ) {
                      localStorage.removeItem('giftlist_events');
                      window.location.reload();
                    }
                  }}
                >
                  ğŸ—‘ï¸ æ¸…é™¤äº‹ä»¶
                </Button>
              </div>
            </form>
          </FormLayout>
        </PageLayout>

        {/* å¯¼å…¥Excelæ¨¡æ€æ¡† */}
        <ImportExcelModal
          isOpen={showImportModal}
          onClose={() => setShowImportModal(false)}
          onImportSuccess={handleImportSuccess}
          currentEvent={selectedEvent}
          allEvents={state.events}
        />
      </>
    );
  }

  // åŠ è½½çŠ¶æ€
  return (
    <>
      <PageLayout title="ç”µå­ç¤¼ç°¿ç³»ç»Ÿ" subtitle="æ­£åœ¨åˆå§‹åŒ–...">
        <div className="text-center fade-in-slow">
          <div className="mt-8 text-sm text-gray-500">
            <p>æ­£åœ¨æ£€æŸ¥å­˜å‚¨çŠ¶æ€...</p>
          </div>
        </div>
      </PageLayout>

      {/* å¯¼å…¥Excelæ¨¡æ€æ¡† */}
      <ImportExcelModal
        isOpen={showImportModal}
        onClose={() => setShowImportModal(false)}
        onImportSuccess={handleImportSuccess}
        currentEvent={selectedEvent}
        allEvents={state.events}
      />
    </>
  );
}