# 📝 更新日志

## 🔥 v1.2.0 - 移除密码功能，简化使用 (2025-12-26)

### 🎯 核心改进

**移除密码功能，让使用更简单！**

基于用户反馈，密码功能在本地应用中意义不大：
- ✅ 数据本地存储，无需云端安全
- ✅ 所有数据可随时导出Excel备份
- ✅ 简化操作流程，提升用户体验

### 🔧 技术变更

#### 数据存储
- **事件数据**：`passwordHash` 字段保留但为空字符串
- **礼金数据**：明文JSON存储（原为加密字符串）
- **会话管理**：不再存储密码

#### 功能简化
- **创建事件**：无需设置密码
- **选择事件**：直接进入，无需密码验证
- **导入数据**：无需密码检测重复
- **导出数据**：无需密码解密

#### 页面更新
- `src/app/page.tsx`：移除密码输入界面，简化为事件选择
- `src/app/setup/page.tsx`：移除密码输入框
- `src/app/main/page.tsx`：移除密码验证逻辑
- `src/store/appStore.ts`：移除密码状态管理
- `src/lib/backup.ts`：移除密码参数和加密逻辑
- `src/components/business/ImportExcelModal.tsx`：移除密码输入

### 💡 数据兼容性

**旧数据迁移：**
- ✅ 旧的加密数据仍然可以读取（store会自动解析）
- ✅ 新数据以明文格式存储
- ✅ 导出Excel功能不受影响

**安全性说明：**
- ⚠️ 数据存储在浏览器本地，可导出
- ⚠️ 适合个人/小型活动使用
- ⚠️ 如需更高安全性，建议使用专业财务软件

---

## 🔥 v1.1.0 - Excel统一导入导出方案 (2025-12-26)

### ✨ 新增功能

#### 📊 Excel统一导入导出
**统一使用Excel进行数据导入导出，简化操作流程！**

**导出功能：**
- **📊 导出数据**：导出当前事件为Excel
  - 礼金明细表：序号、姓名、金额、大写金额、支付方式、备注、时间
  - 统计汇总表：总人数、总金额、支付方式统计、事件信息
- **📚 导出全部**：导出所有事件为Excel（多工作表）
  - 每个事件包含：礼金明细表 + 事件信息表
  - 自动按事件名称命名工作表

**导入功能：**
- **📥 导入数据**：导入Excel文件，支持多种场景：
  - **创建新事件**：自动读取Excel中的事件信息创建新事件
  - **导入到现有事件**：合并到指定事件，需要密码验证
  - **重复数据处理**：
    - 跳过重复（保留原有数据）
    - 覆盖重复（用新数据替换）
    - 都保留（添加所有数据）
- **智能预览**：导入前预览数据，确认无误再导入
- **冲突检测**：自动识别重复数据并提示处理

### 🎯 核心优势

**简化流程：**
- ❌ 旧方案：JSON备份 + Excel导出 + Excel导入（3个功能）
- ✅ 新方案：统一使用Excel导入导出（2个功能）

**用户体验：**
- **操作更简单**：导入导出都用Excel，无需切换格式
- **数据更直观**：Excel可直接编辑，修改后重新导入
- **兼容性更好**：Excel是通用格式，方便与其他系统交互
- **功能更强大**：支持多事件批量导出和导入

### 📁 文件变更

#### 新增
- `src/components/business/ImportExcelModal.tsx` - Excel导入模态框
  - 多步骤流程：选择 → 预览 → 配置 → 结果
  - 支持密码输入和冲突策略选择
  - 智能事件选择和自动配置

#### 修改
- `src/lib/backup.ts`
  - 新增 `previewExcel()` - 预览Excel文件内容
  - 新增 `importExcel()` - 导入Excel数据
  - 新增 `exportAllExcel()` - 导出所有事件为Excel
  - 优化 `exportExcel()` - 支持事件信息导出

- `src/app/main/page.tsx`
  - 更新按钮：导出数据、导出全部、导入数据
  - 替换导入模态框为Excel版本
  - 更新导入成功处理逻辑
  - 添加导出全部功能（需要密码解密）

- `README.md`
  - 更新数据备份章节为Excel统一方案
  - 更新使用说明和小贴士

### 🎯 使用说明

**导出当前事件：**
```
点击：📊 导出数据
结果：礼簿_事件名称_20251226.xlsx
```

**导出所有事件：**
```
点击：📚 导出全部
输入：密码（用于解密数据）
结果：礼簿数据_20251226.xlsx（多工作表）
```

**导入数据：**
```
点击：📥 导入数据
选择：Excel文件
配置：
  - 创建新事件 或 导入到现有事件
  - 如导入到现有事件，需输入密码
  - 选择重复数据处理策略
确认：导入
```

### 💡 迁移指南

**从旧版本升级：**
1. 旧的JSON备份仍然可用（通过JSON导入导出功能）
2. 建议逐步迁移到Excel方案
3. Excel格式更通用，推荐作为主要备份格式

**数据兼容性：**
- ✅ 旧的JSON备份可以继续使用
- ✅ 新的Excel导入支持读取事件信息
- ✅ 可以混合使用两种格式

---

## 🔥 v1.0.3 - 智能语音播报 (2025-12-26)

### ✨ 新增功能

#### 🎙️ 智能语音播报
- **自动播报**：每次录入礼金时自动语音播报确认信息
  - 播报内容：姓名 + 中文大写金额 + 支付类型 + 备注（如有）
  - 示例：`张三，贰仟元整，现金`
  - 示例：`李四，壹仟元整，微信，备注：新婚快乐`

- **操作语音反馈**：
  - ✅ **录入成功**：播报"录入成功"
  - ✅ **修改记录**：播报修改后的信息
  - ✅ **删除记录**：播报删除信息
  - ✅ **错误提示**：播报错误信息

- **表单状态显示**：
  - 语音状态提示（✅ 语音播报已就绪）
  - 自动检测浏览器支持情况

### 🎯 技术特性

- **零依赖**：使用浏览器原生 Web Speech API
- **智能检测**：自动检测浏览器支持情况
- **优雅降级**：不支持的浏览器自动隐藏相关功能
- **异步执行**：语音播报不阻塞表单提交
- **中文优化**：优先使用中文语音，语速适中（0.9倍）

### 📁 文件变更

#### 新增
- `src/lib/voice.ts` - 语音播报核心服务
  - `isVoiceSupported()` - 检测浏览器支持
  - `speakText()` - 基础文本播报
  - `speakGiftData()` - 礼金数据播报
  - `speakSuccess()` / `speakError()` - 状态提示
  - `stopVoice()` - 停止播报

#### 修改
- `src/components/business/GiftEntryForm.tsx`
  - 集成语音播报功能
  - 添加语音状态提示

- `src/app/main/page.tsx`
  - 集成编辑/删除语音反馈

### 🎯 使用说明

**自动播报（录入时）：**
```
输入：张三，2000元，现金
播报：张三，贰仟元整，现金
```

**操作反馈：**
```
修改：修改成功，王五，伍佰元整，现金
删除：已删除 张三 的记录
成功：录入成功
失败：录入失败，请重试
```

**状态提示：**
- 录入表单底部显示：✅ 语音播报已就绪
- 不支持的浏览器自动隐藏提示

### 🌐 浏览器兼容性

- ✅ **Chrome/Edge**：完全支持
- ✅ **Firefox**：支持
- ✅ **Safari**：支持
- ⚠️ **移动浏览器**：可能需要用户交互后才能播放

### 💡 用户体验提升

- **录入确认**：无需看屏幕，听声音即可确认录入正确
- **防错提醒**：播报错误时立即知晓
- **操作反馈**：修改、删除都有语音确认
- **无障碍友好**：为视障用户提供便利
- **现场氛围**：增加仪式感和互动性

---

---

## 🔥 v1.1.0 - Excel导出功能 (2025-12-25)

### ✨ 新增功能

#### 📊 Excel导出
- **双工作表导出**：
  - **礼金明细表**：包含序号、姓名、金额、大写金额、支付方式、备注、时间
  - **统计汇总表**：总人数、总金额、各支付方式统计、事件信息、导出时间

- **智能数据处理**：
  - 自动过滤已作废的记录
  - 中文大写金额转换（如：壹仟贰佰叁拾元整）
  - 按支付方式分类统计

- **专业格式**：
  - 表头加粗、灰色背景
  - 单元格居中对齐
  - 自动列宽调整
  - 宋体字体，适合打印

### 📁 文件变更

#### 新增
- `src/lib/backup.ts` - 添加 `exportExcel()` 方法
  - 使用 `xlsx` 库生成Excel文件
  - 支持双工作表结构
  - 自动下载文件

#### 修改
- `src/app/main/page.tsx` - 更新导出按钮功能
  - 调用 `BackupService.exportExcel()`
  - 传递解密后的礼金数据

- `README.md` - 更新功能说明
  - 添加Excel导出特性介绍
  - 更新使用指南

### 🎯 使用方式

在主界面点击 **"导出Excel"** 按钮，即可下载包含以下内容的Excel文件：

```
礼簿_事件名称_20251225.xlsx
├── 礼金明细表
│   ├── 序号 | 姓名 | 金额 | 金额大写 | 支付方式 | 备注 | 录入时间
│   └── 数据行...
└── 统计汇总表
    ├── 总人数：15人
    ├── 总金额：¥25,800.00（贰万伍仟捌佰元整）
    ├── 支付方式统计
    │   ├── 现金：¥12,000（8笔）
    │   ├── 微信：¥8,800（4笔）
    │   └── 支付宝：¥5,000（3笔）
    └── 事件信息
        ├── 事件名称：张三李四婚礼
        ├── 开始时间：2025-12-25
        ├── 结束时间：2025-12-26
        ├── 记账人：王五
        └── 导出时间：2025-12-25
```

### 💡 技术实现

- **依赖**：已集成 `xlsx` (v0.18.5) 库
- **纯前端**：浏览器端生成Excel，无需后端
- **数据安全**：仅导出已解密的有效数据
- **兼容性**：支持所有现代浏览器

### 🐛 修复

- 修复了导出功能占位符提示
- 优化了文件名处理（自动移除特殊字符）

---

## 📚 历史版本

### v1.0.0 - 基础功能 (2025-12-24)

**核心功能：**
- ✅ 事件管理（创建、登录、密码保护）
- ✅ 礼金录入（姓名、金额、支付方式、备注）
- ✅ 数据展示（主屏12列网格）
- ✅ 副屏投影（实时同步、自动翻页）
- ✅ 打印/PDF（横屏A4、竖排格式）
- ✅ 数据备份（JSON导入导出）
- ✅ 数据安全（AES-256加密、本地存储）

**技术栈：**
- React 18 + TypeScript
- Tailwind CSS
- CryptoJS (加密)
- Vite (构建)
- vite-plugin-singlefile (单文件打包)

---

## 🔮 未来计划

- [ ] 数据统计图表（饼图、柱状图）
- [ ] 多语言支持
- [ ] 云端同步（可选）
- [ ] 数据导出为CSV格式
- [ ] 批量导入功能
- [ ] 数据筛选和搜索

---

## 📝 开发说明

### 提交规范
- `feat:` 新功能
- `fix:` 修复bug
- `style:` 样式修改
- `refactor:` 代码重构
- `docs:` 文档更新

### 发布流程
1. 更新版本号
2. 更新 CHANGELOG.md
3. 更新 README.md
4. 构建测试
5. 创建 Git Tag
6. 发布 Release

---

**感谢使用！🎉**
